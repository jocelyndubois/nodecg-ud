<!DOCTYPE html>
<html>
<body>
	<label>Backgrounds :</label>
	<select name="backgroundSelect" id="backgroundSelect"></select>
	<button id="fetchBackgroundButton">Fetch backgrounds</button>
	<button id="loadBackgroundButton">Send</button>

	<img id="demoBackground" src="#" width="256" height="144"/>
</body>

<script>
	const backgrounds = nodecg.Replicant('assets:background');
	const background = nodecg.Replicant('background');
	const backgroundSelect = document.querySelector('#backgroundSelect');
	const demoBackground = document.querySelector('#demoBackground');

	const fetchBackgroundButton = document.querySelector('#fetchBackgroundButton');
	fetchBackgroundButton.onclick = () => {
		loadBacks();
	};

	const loadBackgroundButton = document.querySelector('#loadBackgroundButton');
	loadBackgroundButton.onclick = () => {
		background.value = backgroundSelect.value;
	};

	function loadBacks() {
		var length = backgroundSelect.options.length;
		for (let i = length-1; i >= 0; i--) {
			backgroundSelect.options[i].remove();
		}

		let counter = 0;
		backgrounds.value.forEach(function (background) {
			let back = document.createElement("option");
			back.value = background.url;
			back.text = background.name;
			if (0 === counter) {
				back.setAttribute('selected', 'selected');
			}

			backgroundSelect.add(back);
			++counter;
		});

		backgroundSelect.onchange();
	}

	backgroundSelect.onchange = () => {
		demoBackground.src = backgroundSelect.value;
	}


	backgrounds.on('change', (newValue) => {
		loadBacks();
	});
</script>
</html>
